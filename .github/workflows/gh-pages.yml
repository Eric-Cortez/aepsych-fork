# Copyright (c) Meta Platforms, Inc. and affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.
# https://github.com/marketplace/actions/github-pages
name: Build and Deploy

on:
  push:
    branches: [new]
  pull_request:
    branches: [main]
permissions:
  contents: write
  deployments: write
  packages: write

jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # Recommended if you intend to make multiple deployments in quick succession.
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    # Node is required for npm
    - name: Setup Node.js environment
      uses: actions/setup-node@v3.3.0
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: |
        pip install -U sphinx
        pip install beautifulsoup4 ipython nbconvert "jinja2==3.0.3"
    - name: Dependencies
      run: |
        sudo apt-get install -y yarn
      id: build
    - name: Build the Website
      run: |
        ./scripts/build_docs.sh -b
    - name: Deploy ðŸš€
      uses: JamesIves/github-pages-deploy-action@v4.3.3
      with:
        branch: gh-pages # The branch the action should deploy to.
        folder: website/build # The folder the action should deploy
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
